# jvm

<!-- TOC -->

- [jvm](#jvm)
    - [jvm01 JVM内存结构](#jvm01-jvm内存结构)
        - [快速了解](#快速了解)
        - [深入分析](#深入分析)

<!-- /TOC -->

## jvm01 JVM内存结构

    java内存结构也就是jvm内存结构，我们经常说的jvm内存结构，包含了堆内存，栈和方法区等内容，是学习jvm必备的知识。

首先要知道的就是java内存结构等同于jvm内存结构！下面是jvm内存结构图

![aa](https://img-blog.csdnimg.cn/20191113201731692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9pdGh1YW5ncWluZy5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70)

然后jvm内存结构包含以下内容

1. 程序计数器
2. java虚拟机栈
3. 本地方法栈
4. java堆
5. 方法区运行时常量池

### 快速了解

**程序计数器**

较小的内存空间，可以当成是当前线程执行的字节码行号指示器，也就是根据这个程序计数器来解决下一步要执行什么，线程私有

**java虚拟机栈**

这就是我们经常说的栈内存，准确来说是java虚拟机栈中的局部变量表。存放基本数据类型和对象引用，注意是局部变量表，java虚拟机栈中存放的可不止这些！线程私有，与java方法相关，生命周期同线程一样！

**本地方法栈**

与java虚拟机栈非常相似，有的虚拟机就把本地方法栈和java虚拟机合二为一，比如Sun HotSpot虚拟机！

**堆** 

这个就是堆内存了，应该算是jvm内存中大家接触的最多的一个，它是jvm内存中空间最大的一块内存，主要存储对象实例。也是gc主要光顾的地方

**方法区和运行时常量池**

和java堆一样，是线程共享的，存储被虚拟机加载的类信息，常量，静态变量，即时编译后的代码等数据，字符串常量池在jdk1.7之前在方法区，在jdk1.7及之后字符串常量池从方法区移除，放在了堆内存中。

运行时常量池也在方法区中，用于存放Class文件中的字段，方法，接口和常量池等信息内容。

### 深入分析

**程序计数器**

程序计数器，有的地方也叫做pc计数器，都是它，是在jvm内存中属于较小的一个内存空间，但是十分重要，我们知道在多线程中，是靠CPU来切换线程的执行顺序的方式来实现的，也就是说从线程A切换到线程B，然后在切换到线程A的时候，CPU是怎么知道应该执行线程A中的哪一步，也就是说，之前在线程A中执行到哪了，这就要靠程序计数器去记录了。

这就是程序计数器了，另外要知道的就是程序计数器是线程私有的，相互独立，如果被问到什么是程序计数器，我觉得可以这样回答：

    当前线程所执行的字节码的行号指示器

**java虚拟机栈**

我们之前应该经常会说或者经常听到堆内存和栈内存，堆内存想必大家都很熟悉了，这个我们随堆内存经常说的应该是java虚拟机栈中的局部变量表中的。

java虚拟机栈也是线程私有的，生命周期跟随线程，很重要的一个点就是要明白java虚拟机栈是与java方法相关的。

当线程开始，也就产生了这个java虚拟机栈，当一个java方法会调用的时候就会产生一个栈帧。

这个时候产生的一个栈帧就是用来存放局部变量表，操作数栈，动态链接和方法出口信息等，注意，这里的局部变量表是在栈帧中保存。另外，一个方法从调用到执行结束的整个过程就是一个栈帧在java虚拟机栈中从入栈到出栈，这就把栈帧和java虚拟机栈联系起来了。

而这个局部变量表是干嘛的呢？就是用来存放各种基本数据类型，对象的引用的，这就是大家常说的栈内存所做的事情，可能这里还要注意的就是这里说的基本数据类型都是在编译期已经确定下来的，而且局部变量的空间在编译期就是确定的，运行时期是不会在改变的。

**本地方法栈**



    
